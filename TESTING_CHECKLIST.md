# 功能测试清单 / Testing Checklist

## 自动化测试结果

✅ **全部通过**: 10/10 tests (2 test files)

- `src/background/test/background.test.ts` - 1 test
- `src/utils/test/time.test.ts` - 9 tests

## 手动测试计划

### 1. 配置迁移测试 (v1 → v2)

**目标**: 验证旧配置自动迁移到新的多规则系统

**步骤**:

1. 清除浏览器扩展的存储数据（chrome://extensions/ → 开发者模式 → 清除）
2. 安装扩展
3. 打开 Options 页面
4. ✅ 验证：应该看到一个默认的"工作计划提醒"规则（Mon-Fri, 09:00-10:00）
5. ✅ 验证：首次引导（Onboarding）应该显示

**预期结果**:

- 默认规则正确创建
- 语言根据浏览器设置自动选择（中文/英文）

---

### 2. 新 UI 布局测试

**目标**: 验证左右分栏布局正常工作

**步骤**:

1. 打开 Options 页面 (chrome-extension://[your-id]/pages/options.html)
2. ✅ 验证：左侧导航栏显示 5 个选项
   - General (常规设置)
   - Reminder Rules (提醒规则)
   - Template (模板)
   - Quick Links (快捷链接)
   - Statistics (统计)
3. ✅ 验证：点击每个导航项，右侧内容区正确切换
4. ✅ 验证：底部固定的"Save Settings"按钮始终可见

**预期结果**:

- 布局美观，类似"沉浸式翻译"扩展
- 导航流畅，无错误

---

### 3. 多规则 CRUD 测试

#### 3.1 创建新规则

**步骤**:

1. 进入 "Reminder Rules" 页面
2. 点击 "Add New Reminder Rule" 按钮
3. ✅ 验证：新规则自动展开
4. ✅ 验证：新规则默认启用（Switch 为 ON）
5. 修改规则名称为 "下午茶提醒"
6. 设置工作日：选择 Mon-Fri
7. 设置时间：15:00 - 16:00，间隔 30 分钟
8. 设置通知标题："下午茶时间到了！"
9. 设置通知消息："休息一下，喝杯茶吧~"
10. 设置 Toast 消息："下午茶时间！"
11. 点击 "Save Settings"

**预期结果**:

- 规则成功创建
- 保存成功提示显示（绿色 ✓ 图标）
- 刷新页面后规则仍然存在

#### 3.2 编辑现有规则

**步骤**:

1. 找到刚才创建的"下午茶提醒"规则
2. 点击展开/收起按钮（chevron icon）
3. ✅ 验证：规则展开显示所有字段
4. 修改间隔时间为 15 分钟
5. 添加 Late Reminder: 16:30
6. 点击 "Save Settings"

**预期结果**:

- 修改成功保存
- Late Reminder 正确添加

#### 3.3 启用/禁用规则

**步骤**:

1. 找到"下午茶提醒"规则
2. 点击 Switch 按钮禁用
3. ✅ 验证：规则状态变为灰色/禁用状态
4. 再次点击 Switch 启用
5. 点击 "Save Settings"

**预期结果**:

- 切换状态正确反映
- 禁用的规则不会触发提醒

#### 3.4 删除规则

**步骤**:

1. 创建至少 2 个规则（确保不是最后一个）
2. 点击某个规则的删除按钮（垃圾桶图标）
3. ✅ 验证：显示确认对话框 "Are you sure you want to delete this rule?"
4. 点击"确定"
5. ✅ 验证：规则被删除
6. 尝试删除最后一个规则
7. ✅ 验证：显示错误提示 "You must keep at least one reminder rule"

**预期结果**:

- 删除功能正常
- 保护机制生效（至少保留一个规则）

---

### 4. 工作日选择测试

**步骤**:

1. 展开任意规则
2. 点击工作日按钮（Mon/Tue/Wed/Thu/Fri/Sat/Sun）
3. ✅ 验证：选中的天数背景变为蓝色（primary-600）
4. ✅ 验证：未选中的天数背景为白色
5. 创建不同的工作日组合：
   - 规则 A: Mon-Fri（工作日）
   - 规则 B: Sat-Sun（周末）
   - 规则 C: 仅 Wed（每周三）
6. 保存并验证

**预期结果**:

- 工作日选择器正常工作
- 不同规则可以有不同的工作日设置

---

### 5. 后台提醒调度测试

**目标**: 验证多规则的提醒调度逻辑

**测试场景 1**: 多个规则同时启用

**步骤**:

1. 创建两个规则：
   - 规则 A: 09:00-10:00, 间隔 15 分钟
   - 规则 B: 15:00-16:00, 间隔 30 分钟
2. 保存配置
3. 打开浏览器控制台（F12 → Console）
4. 查看后台日志（chrome://extensions/ → 背景页 → Inspect views）
5. ✅ 验证：日志显示 "Next reminder scheduled at: [时间] for rule: [规则名称]"
6. ✅ 验证：选择的是最早的下一次提醒时间

**预期结果**:

- 后台正确找到最早的提醒时间
- 多个规则不会冲突

**测试场景 2**: 同一时间段多个规则

**步骤**:

1. 创建两个规则：
   - 规则 A: 09:00-10:00, 通知标题 "工作计划"
   - 规则 B: 09:00-10:00, 通知标题 "吃药提醒"
2. 等待 09:00 提醒触发
3. ✅ 验证：两个通知都应该显示

**预期结果**:

- 所有应该触发的规则都会触发
- 通知内容正确区分

---

### 6. Popup 页面测试

**步骤**:

1. 配置多个规则（部分启用，部分禁用）
2. 点击浏览器工具栏的扩展图标，打开 Popup
3. ✅ 验证：显示当前时间
4. ✅ 验证：如果今天是工作日（任意规则定义），显示"待发送"状态
5. ✅ 验证：显示第一个启用规则的截止时间倒计时
6. ✅ 验证：模板内容正确显示
7. ✅ 验证：快捷链接正常工作
8. 点击 "Mark as Sent" 按钮
9. ✅ 验证：状态变为"已发送"（绿色 ✓）
10. ✅ 验证：Badge 消失

**预期结果**:

- Popup 正确显示多规则状态
- 标记功能正常工作

---

### 7. 语言切换测试

**步骤**:

1. 进入 "General" 页面
2. 切换语言：English ↔ 中文
3. ✅ 验证：UI 语言立即切换
4. ✅ 验证：创建新规则时，默认名称使用新语言
5. ✅ 验证：模板内容自动更新为新语言

**预期结果**:

- i18n 正常工作
- 所有新创建的内容使用正确的语言

---

### 8. 休眠唤醒测试

**目标**: 验证修复的休眠重复弹窗问题

**步骤**:

1. 设置一个规则：09:00-10:00, 间隔 15 分钟
2. 在 09:00-09:30 之间让电脑进入休眠
3. 在 09:30 之后唤醒电脑
4. ✅ 验证：只弹出 1 次通知，而不是积压的 2-3 次

**预期结果**:

- 修复生效，唤醒后只触发 1 次提醒

---

### 9. 边界条件测试

#### 9.1 时间验证

- ✅ 开始时间 >= 截止时间？（应该允许，因为可能跨天）
- ✅ Late Reminder 时间 < 截止时间？（应该警告）
- ✅ 间隔时间设为 0 或负数？（应该有最小值限制）

#### 9.2 数据验证

- ✅ 规则名称为空？
- ✅ 所有工作日都未选中？
- ✅ Toast 持续时间设为 0 秒？（应该有最小值 5 秒）

#### 9.3 性能测试

- ✅ 创建 10+ 个规则，页面是否卡顿？
- ✅ 快速切换启用/禁用，是否有延迟？

---

### 10. 导入/导出测试

**步骤**:

1. 创建多个自定义规则
2. 点击 "Export" 按钮
3. ✅ 验证：下载 JSON 文件
4. 清除所有数据
5. 点击 "Import" 按钮，选择刚才的 JSON 文件
6. ✅ 验证：所有规则恢复

**预期结果**:

- 导入/导出正确保存和恢复所有规则

---

## 回归测试

确保旧功能仍然正常：

- ✅ 模板复制功能
- ✅ 快捷链接管理
- ✅ 统计数据显示
- ✅ 键盘快捷键 (mark-as-sent, open-options)
- ✅ Toast 消息在活动标签页显示
- ✅ 通知点击打开 Options 页面

---

## 测试环境

- [ ] Chrome (推荐版本: 120+)
- [ ] Edge
- [ ] Firefox (使用 webextension-polyfill)

---

## 已知问题

无

---

## 测试结论

- [ ] 所有核心功能正常
- [ ] 所有边界条件处理正确
- [ ] 无性能问题
- [ ] UI 美观且易用

测试完成日期: ****\_\_\_****
测试人员: ****\_\_\_****
